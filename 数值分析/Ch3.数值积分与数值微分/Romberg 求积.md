# 梯形递推化

从复合求积的角度来看，他做了这么一个操作：将单一的区间变成多个子区间进行积分，进而得到更加精准的结果。

而数学中很多采样的方法基于两点，进而获取其中点进行后续处理，即类似二分的处理手段：
$$\begin{align}
T_n&=\frac{h}{2}[f(a)+2\sum_{i=1}^{n-1}f(a+ih)+f(b)]\\
T_{2n}&=\frac{h'}{2}[f(a)+2\sum_{i=1}^{2n-1}f(a+ih')+f(b)]\\
&=\frac{h}{4}[f(a)+2\sum_{i=1}^{2n-1}f(a+i\frac{h}{2})+f(b)]\\
&=\frac{h}{4}[f(a)+2\sum_{i=2,i=2k,k\in\mathbb Z}^{2n-2}f(a+i\frac{h}{2})+2\sum_{i=1,i=2k-1,k\in\mathbb Z}^{2n-1}f(a+i\frac{h}{2})+f(b)]\\
&=\frac{h}{4}[f(a)+2\sum_{i=1}^{n-1}f(a+2i\frac h2)+f(b)]+\frac{h}{2}\sum_{i=0}^{n-1}f(a+(i-\frac{1}{2}i)h)
\end{align}$$
归纳后可以得到其递推公式：
$$T_{2n}=\frac12T_{n}+\frac{h}{2}\sum_{i=1}^{n}f(a+(i-\frac{1}{2}i)h)$$
也就是原先的复合梯形积分值，加上插值点在小区间$h$上得到的矩形值，再通过归一化处理，即初一$2$得到$T_{2n}$的结果

# 梯形积分的余项

回顾一下梯形积分的余项，会有：
$$\begin{align}
&R[f]=Kf^{n}(\eta)\\
&K=\frac{1}{(n+1)!}[\frac{1}{n+2}(b^{n+2}-a^{n+2})-(b-a)\sum_{k=0}^nC_n^{(k)}x_k^{n+1}]\\
\\
&n:Newton-Cotes ~的最高代数精度
\end{align}$$
则以$n=1$取值，并且其代数精度为1，会有：
$$R[T_n]=\frac{b-a}{12}(\frac{b-a}{2n})^2f'(\xi)$$
那么则会有：
$$R[T_{2n}]=\frac{b-a}{12}(\frac{b-a}{4n})^2f'(\xi)$$
# Richardson 外推

关于 Simpson 公式的由来，同样可以由泰勒展开的角度出发进行考虑，记实际的积分结果为$I$。
$$\begin{align}
T_n&=I+c_1h^2+ O(h^4)\\
T_{2n}&=I+c_1(\frac h2)^2+O(h^4)\\
&=I+\frac {c_1}4h^2+O(h^4)
\end{align}$$
那该如何消除$h^2$的误差，则是通过线性组合，同时还需保留$I$的值，也就是：
$$I=\frac{1}{3}(4T_{2n}-T_n)$$
同时也可以消除掉$h^2$的误差，尽量保留积分值，也就是所谓“松弛法”的思想内核。

**Richardson 外推**

将$I$的值由$O(h^2)$到$O(h^4)$的这种情况，都可以用此进行计算得到更高的精确度。

同样的，由 Simpson 算法进行求解可以得到：
$$\begin{align}
S_{n}&=I+\beta_1h^4+O(h^6)\\
S_{2n}&=I+\beta_1(\frac{h}{2})^4+O(h^6)\\
&=I+\frac{1}{16}\beta_1h^4+O(h^6)\\
\Rightarrow I&=\frac{16S_{2n}-S_{n}}{15}
\end{align}$$
这也就是 Cotes 公式的另外一种得来

**Richardson 外推加速算法**
$$T_m(h)=\frac{4^m}{4^m-1}T_{m-1}(\frac{h}{2})-\frac{1}{4^m-1}T_{m-1}(h)$$
这里的 $4^m$ 来源于步长减半时，二阶误差减少了$2^2=4$倍（因为 $h^2 \to (h/2)^2 = h^2/4$，所以系数是 $4^m$，表示在第$m$层次的逼近中所达到的误差阶次

# Romberg 算法

由此可以得到 Romberg 求积算法：

$$T_m^{(k)}=\frac{4^m}{4^m-1}T^{(k+1)}_{m-1}-\frac{1}{4^m-1}T^{(k)}_{m-1}$$
也就是表格的这个形式：

| $k$ | $h$             | $T_0^{(k)}$ |                         | $T_1^{(k)}$ |                         | $T_2^{(k)}$ |
| --- | --------------- | ----------- | ----------------------- | ----------- | ----------------------- | ----------- |
| $0$ | $b-a$           | $T_0^{0}$   |                         |             |                         |             |
| $1$ | $\frac{b-a}{2}$ | $T_0^{1}$   | $\downarrow\rightarrow$ | $T_1^{0}$   |                         |             |
| $2$ | $\frac{b-a}{4}$ | $T_0^{2}$   | $\downarrow\rightarrow$ | $T_1^{1}$   | $\downarrow\rightarrow$ | $T_2^{0}$   |
也就是一个新值对应的是前两个值的由误差出发的组合，其上标对应了切片大小，下标则对应其误差阶

[[Newton-Cotes 公式]]
[[Newton 插值与差商]]
[[误差]]
