# 矩形公式

数值积分的本质源于：
$$\int_a^bf(x)dx=\lim_{n\to\infty}\sum_{i=0}^nf(\xi_i)(x_{i+1}-x_i)$$
那么从根源上来看，后半部分除去极限与求和，其为一个于区间上乘以一个 $y$ 值的矩形，那么就会有一个问题，即如何求解 $\xi$ 的值。但是从求解的角度看，应当是给其赋值，而不是求值。

那也就是有几种思路，一是在端点取值，一般称其为左、右矩形公式，即：
$$\int_a^bf(x)dx\thickapprox{(b-a)}f(a)~or~{(b-a)}f(b)$$
不过这种方式遇到带有一定递增、递减性质的函数，其误差非常大，因此常采用中点所对应的函数值为其“高”进行处理，也就是中矩形公式：
$$\int_a^bf(x)dx\thickapprox{(b-a)}f(\frac{b-a}2)$$

# 梯形公式

数值积分的本质仍是对函数曲线下的面积进行近似估算，前提依然源于：

$$
\int_a^b f(x)\,dx = \lim_{n \to \infty} \sum_{i=0}^{n} f(\xi_i)(x_{i+1} - x_i)
$$

而矩形公式是用一系列**矩形的面积**去逼近曲线下的积分面积，梯形公式则更进一步，采用的是**梯形的面积**来替代。这一改进的本质，是在每个小区间 $[x_i, x_{i+1}]$ 上，不再使用某一个点的函数值作为整个区间的“高”，而是利用端点函数值的平均来作为近似，也即是将曲线近似为线性函数。

我们知道，左右矩形公式分别是取区间端点处的函数值作为“高”来近似积分面积：
左矩形公式：
  $$\int_a^b f(x)\,dx \approx (b - a)\,f(a)$$
右矩形公式：
$$\int_a^b f(x)\,dx \approx (b - a)\,f(b)$$
然而这两者在遇到单调函数时容易产生系统性误差——左端点在递增函数下总是低估，而右端点则高估。于是一个自然的改进方式就是：**取左右矩形的平均值**。这便引出了**梯形公式**：

$$
\int_a^b f(x)\,dx \thickapprox \frac{b-a}{2} [f(a) + f(b)]
$$

这相当于用一个顶点分别为 $(a, f(a))$ 和 $(b, f(b))$ 的梯形来近似整个积分区域，能够对一些线性或平缓变化的函数提供更准确的近似。
几何上可以理解为：将曲线 $f(x)$ 在 $[a,b]$ 上用一条直线连接 $f(a)$ 与 $f(b)$ 来近似，即将曲线“拉直”，从而形成一个梯形进行面积估算。因而，梯形公式本质上就是左右矩形面积的平均：

梯形公式较矩形公式而言，误差通常更小，尤其是在函数较为光滑的情况下，逼近效果更优。

这种思想也是后续很多的基础

# 余项

以 Lagrange 插值作为积分的依据函数，之前说过，在幂函数多项式中做积分运算，或是微分运算，其实际上是做了一个线性变换：
$$
\int f(x)dx=
\begin{bmatrix}
0& 0& \cdots& 0\\
1& 0& \cdots& 0\\
0& \frac12& \cdots& 0\\
& & \vdots& \\
0& 0& \cdots& \frac{1}{n+1}
\end{bmatrix}f(x)
$$
那么也就是说，如果将幂函数独立进行积分，其得到的积分结果再进行累加得到了，$f(x)$ 积分结果，仍然是一个幂函数族经线性组合,也就是
$$\int f(x)=\sum_{i=0}^nA_if(x_i)$$
那么放到 Lagrange 插值的余项：
$$\begin{align}
R(x)=f(x)-L(x)=\frac{f^{(n+1)}(\xi)}{n!}w(x)\\
w(x)=(x-x_1)(x-x_2)\cdots(x-x_n)
\end{align}$$
若代数精度为$m$，则会有：
$$R[f]=\int^b_a\frac{f^{(m+1)}(\xi)}{(m+1)!}w(x)dx=\frac{f^{(m+1)}(\xi)}{(m+1)!}\int^b_a(x-a)(x-(a+h))\cdots(x-b) dx$$
而放在幂函数族里面，以最高代数精度为例：
$$R_n[f]=\frac{{f^{(m+1)}(\xi)}}{(m+1)!}[\int_a^bx^{m+1}dx-\sum_{i=0}^nA_ix_i^{m+1}]=\frac{{f^{(m+1)}(\xi)}}{(m+1)!}[\frac{1}{m+2}(b^{m+2}-a^{m+2})-\sum_{i=0}^nA_ix_i^{m+1}]$$
前面为最高次下的 Lagrange 插值余项，利用 Roole 定律确定，后面左侧则为更高次的积分结果，右侧为构造的积分表达式在采样点下的组合结果
即左侧分子式为归一化的精度结果，右侧为更高次的积分结果减去构造式表达

# 收敛与稳定

收敛与稳定的内涵其实很简单，前者为极限趋于积分值，而后者为所有积分系数 $A_i$ 为正值

[[Lagrange 插值]]
[[函数空间]]
[[数值稳定]]